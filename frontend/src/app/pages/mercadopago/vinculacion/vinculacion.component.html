<div class="container">
      <div class="card">
        <div class="card-header">
          <h2>Conectar con MercadoPago</h2>
        </div>
        <div class="card-body">
          <!-- Mostrar info del usuario logueado -->
          <div class="user-info" *ngIf="userInfo">
            <p><strong>Usuario:</strong> {{ userInfo.fullName }}</p>
            <p><strong>Email:</strong> {{ userInfo.email }}</p>
            <p><strong>ID:</strong> {{ userInfo.userId }}</p>
          </div>

          <p>Para poder procesar pagos, necesitas conectar tu cuenta de MercadoPago.</p>
          
          <!-- Mostrar error si no hay token -->
          <div *ngIf="!hasValidAuth" class="alert alert-warning">
            <strong>⚠️ Atención:</strong> No tienes una sesión válida. Por favor, inicia sesión nuevamente.
            <button class="btn btn-link" (click)="redirectToLogin()">Ir a Login</button>
          </div>

          <!-- Formulario de conexión -->
          <div *ngIf="hasValidAuth">
            <!-- Opción para usar ID del usuario logueado -->
            <div class="user-selection">
              <label>
                <input 
                  type="radio" 
                  name="userOption" 
                  value="current" 
                  [(ngModel)]="userOption"
                  (change)="onUserOptionChange()"
                >
                Usar mi cuenta actual (ID: {{ userContext.userId }})
              </label>
              
              <label>
                <input 
                  type="radio" 
                  name="userOption" 
                  value="custom" 
                  [(ngModel)]="userOption"
                  (change)="onUserOptionChange()"
                >
                Usar otro ID de usuario
              </label>
            </div>

            <!-- Input para ID personalizado -->
            <div class="form-group" *ngIf="userOption === 'custom'">
              <label for="userId">ID de Usuario:</label>
              <input 
                type="number" 
                id="userId"
                class="form-control"
                [(ngModel)]="customUserId" 
                placeholder="Ingresa el ID de usuario"
              >
            </div>

            <button 
              class="btn btn-primary btn-lg"
              [disabled]="!canConnect || isConnecting"
              (click)="connectToMercadoPago()"
            >
              <span *ngIf="isConnecting" class="spinner"></span>
              {{ isConnecting ? 'Conectando...' : 'Conectar con MercadoPago' }}
            </button>
          </div>

          <div *ngIf="error" class="alert alert-danger mt-3">
            {{ error }}
          </div>
        </div>
      </div>
    </div>